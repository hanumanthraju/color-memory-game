!function(){angular.module("memoryGameApp",["ngRoute","ui.bootstrap"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"template/home.html",controller:"GameController"}).otherwise({redirectTo:"/"})}]).run(["$rootScope",function(e){e.noOfCards=8}])}(),function(){"use strict";angular.module("memoryGameApp").controller("GameController",["$scope","$rootScope","GameService","Utils",function(e,r,o,a){var t=r.noOfCards;e.colorCards=o.getColorCards(t)}])}(),function(){"use strict";angular.module("memoryGameApp").factory("GameService",function(){return{getColorCards:function(e){for(var r=[],o=1;e>=o;o++)r.push(o),r.push(o);return r.sort(function(){return.5-Math.random()}),r}}})}(),function(){angular.module("memoryGameApp").factory("UserService",["$http","$q","transformRequestAsFormPost",function(e,r,o){var a="http://"+document.domain+"/"||"http://ng.local.memory.game/";return e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",{getScores:function(){var o=r.defer(),t=e({method:"get",url:a+"getScores.php"});return t.success(function(e){o.resolve(e)}).error(function(e,r){o.reject(e)}),o.promise},saveScore:function(t){var n=r.defer(),s=e({method:"post",url:a+"saveScore.php",transformRequest:o,data:t});return s.success(function(e){n.resolve(e)}).error(function(e,r){n.reject(e)}),n.promise},getUserStats:function(t){var n=r.defer(),s=e({method:"post",url:a+"getUserStats.php",transformRequest:o,data:t});return s.success(function(e){n.resolve(e)}).error(function(e,r){n.reject(e)}),n.promise}}}])}(),function(){angular.module("memoryGameApp").factory("transformRequestAsFormPost",function(){function e(e,o){var a=o();a["Content-type"]="application/x-www-form-urlencoded; charset=utf-8";var t=r(e);return t}function r(e){if(!angular.isObject(e))return null==e?"":e.toString();var r=[];for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];r.push(encodeURIComponent(o)+"="+encodeURIComponent(null==a?"":a))}var t=r.join("&").replace(/%20/g,"+");return t}return e})}(),function(){"use strict";angular.module("memoryGameApp").factory("Utils",["$window",function(e){function r(e){var r=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return r.test(e)}function o(r,o,a){if(a){var t=new Date;t.setTime(t.getTime()+24*a*60*60*1e3);var n="; expires="+t.toGMTString()}else var n="";e.document.cookie=r+"="+o+n+"; path=/"}function a(r){for(var o=r+"=",a=e.document.cookie.split(";"),t=0;t<a.length;t++){for(var n=a[t];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(o))return n.substring(o.length,n.length)}return null}function t(e){o(e,"",-1)}return{validateEmail:r,createCookie:o,readCookie:a,eraseCookie:t}}])}(),function(){angular.module("memoryGameApp").directive("gameCardsDirective",["Utils","$rootScope","$timeout","$interval","$window","GameService","UserService","$modal",function(e,r,o,a,t,n,s,c){function i(i,u,m){i.currentScore=0,i.pairsOpened=0,i.timeLapsed="00:00",i.bestScore=0,i.gamesPlayed=0,i.totalMoves=0;var l,d=t.jQuery.noConflict(),p=n.getColorCards(r.noOfCards),f=function(e,r){e.addClass("open"),e.css("background-image",'url("img/colour'+p[r]+'.gif")')},g=function(e){e.removeClass("open"),e.css("background-image","")},v=function(e){e.removeClass("open"),e.addClass("closed"),e.css("background-image","none")},C=function(r){i.currentScore=0,i.pairsOpened=0,i.timeLapsed="00:00",i.bestScore=0,i.gamesPlayed=0,i.totalMoves=0;var o=angular.element(document.querySelectorAll("#game-board .card"));o.each(function(e,r){d(r).css("background-image",'url("img/card_bg.gif")'),d(r).removeClass("open"),d(r).removeClass("closed"),d(r).removeClass("selected")}),d(o[0]).addClass("selected"),i.gamesPlayed=0,i.bestScore=0;var t=e.readCookie("memory-game-userid");return t&&s.getUserStats({userid:t}).then(function(e){e.success&&e.obj&&(i.gamesPlayed=parseInt(e.obj.count),i.bestScore=parseInt(e.obj.max))}),r&&a.cancel(r),a(h,1e3)},y=function(e){return e.split(":").reverse().map(Number).reduce(function(e,r,o){return e+r*Math.pow(60,o)})},h=function(){var e=y(i.timeLapsed)+1,r=Math.floor(e/60);r=10>r?"0"+r:r,r=r>60?Math.floor(r/60)+":"+r%60:r;var o=e%60;o=10>o?"0"+o:o,i.timeLapsed=r+":"+o,i.$emit("currentGameDataChanged",{currentScore:i.currentScore,totalMoves:i.totalMoves,pairsOpened:i.pairsOpened,timeLapsed:i.timeLapsed,callApply:!1})},S=function(e){var r=c.open({animation:!1,templateUrl:"template/score-popup.html",controller:k,backdrop:!0,size:"md",windowClass:"modal fade in",resolve:{data:function(){return e}}});r.result.then(function(e){},function(){})},k=function(e,r,o){e.userList=o.userList,e.rankingInfo=o.rankingInfo,e.currentUserId=o.currentUserId,console.log(e.currentUserId),e.ok=function(){r.dismiss("cancel")},e.cancel=function(){r.dismiss("cancel")}};k.$inject=["$scope","$modalInstance","data"];var b=function(r){var o=c.open({animation:!1,templateUrl:"template/register-popup.html",controller:["$scope","$modalInstance","data",function(r,o,a){r.finalScore=a,r.user={},r.submitScore=function(){r.userForm.$valid&&(r.user.userid=e.readCookie("memory-game-userid"),o.close(),O(r.user))},r.playAgain=function(){o.dismiss("cancel"),l=C(l)}}],backdrop:!0,size:"md",windowClass:"modal fade in",resolve:{data:function(){return r}}});o.result.then(function(e){},function(){})},w=function(r){i.gamesPlayed=i.gamesPlayed+1,i.bestScore=Math.max(i.bestScore,i.currentScore),a.cancel(r);var o=e.readCookie("memory-game-userid");if(o){var t={userid:o,name:e.readCookie("memory-game-name"),email:e.readCookie("memory-game-email")};O(t)}else{var n=i.currentScore||0;b(n)}},O=function(r){var o={appId:"memory-game",userid:r.userid,user:r.name,email:r.email,score:i.currentScore||0,moves:i.totalMoves||0,time:y(i.timeLapsed)||0};s.saveScore(o).then(function(r){r.success?(e.createCookie("memory-game-userid",r.userid,10),e.createCookie("memory-game-name",r.name,10),e.createCookie("memory-game-email",r.email,10),$()):alert("Something went wrong. Please try again."),i.showScores(o.score)})};i.showScores=function(r){s.getScores().then(function(o){var a="";if(i.userList=[],o.success&&o.rows&&o.rows.length>0){var t=e.readCookie("memory-game-userid");o.rows.map(function(e,o){var n=t==e.id;n&&(a=(r?"You scored "+r+" in this game! ":"")+"You current rank "+(o+1)+" in the leader board.")});var n={userList:o.rows,rankingInfo:a,currentUserId:e.readCookie("memory-game-userid")};S(n)}})},i.restart=function(){if(i.pairsOpened!=r.noOfCards){var e=confirm("Restarting the game will loose your progress. Are you sure you want to restart?");e&&(p=n.getColorCards(r.noOfCards),l=C(l))}else p=n.getColorCards(r.noOfCards),l=C(l)};var $=function(){i.userAddress=e.readCookie("memory-game-userid")?"Hi":"Welcome",i.userName=e.readCookie("memory-game-userid")?e.readCookie("memory-game-name"):"Guest",i.currentUserId=e.readCookie("memory-game-userid")},A=function(e){"decrease"===e?i.currentScore=i.currentScore-1:i.currentScore=i.currentScore+1};i.notYou=function(){e.eraseCookie("memory-game-userid"),e.eraseCookie("memory-game-name"),e.eraseCookie("memory-game-email"),$(),l=C(l)},i.$on("currentGameDataChanged",function(e,r){r&&(i.currentScore=r.currentScore,i.totalMoves=r.totalMoves,i.pairsOpened=r.pairsOpened,i.timeLapsed=r.timeLapsed),r.callApply&&i.$apply()}),o(function(){angular.element(document).ready(function(){$(),i.currentScore=0,i.pairsOpened=0,i.timeLapsed=0,angular.element(t).bind("keydown",function(e){if(!u.hasClass("modal","open")&&!u.hasClass("game-board","disabled")){i.$emit("currentGameDataChanged",{currentScore:i.currentScore,totalMoves:i.totalMoves,pairsOpened:i.pairsOpened,timeLapsed:i.timeLapsed,callApply:!0});var o=document.querySelector("#game-board .selected"),a=o.previousSiblings().size(),t=r.noOfCards||8,n=t/2,s=2*t-1,c=e.which||e.keyCode;switch(c){case 37:e.preventDefault(),a&&(d(o).removeClass("selected"),d(o.previous()).addClass("selected"));break;case 39:e.preventDefault(),a!=s&&(d(o).removeClass("selected"),d(o).next().addClass("selected"));break;case 40:e.preventDefault(),s>=a+n&&(d(o).removeClass("selected"),d(o.next(n-1)).addClass("selected"));break;case 38:e.preventDefault(),a-n>=0&&(d(o).removeClass("selected"),d(o.previous(n-1)).addClass("selected"));break;case 13:e.preventDefault();var m=document.querySelector("#game-board .open");if(d(o).hasClass("closed"));else if(m)if(m==o);else{f(d(o),a),i.totalMoves=i.totalMoves+1;var p=angular.element(document.querySelector("#game-board"));p.addClass("disabled"),setTimeout(function(){p.removeClass("disabled");var e=d(m).css("background-image"),a=d(o).css("background-image");e==a?(A("increase"),i.pairsOpened=i.pairsOpened+1,v(d(m)),v(d(o)),i.pairsOpened==r.noOfCards&&w(l)):(A("decrease"),g(d(m)),g(d(o)))},250),i.$emit("currentGameDataChanged",{currentScore:i.currentScore,totalMoves:i.totalMoves,pairsOpened:i.pairsOpened,timeLapsed:i.timeLapsed,callApply:!0})}else f(d(o),a)}$()}})}),l=C(l)})}return{restrict:"E",scope:{gameCards:"=gameCards"},link:i,templateUrl:"template/game.html"}}])}();